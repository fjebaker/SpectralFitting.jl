<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Using models · SpectralFitting.jl</title><meta name="title" content="Using models · SpectralFitting.jl"/><meta property="og:title" content="Using models · SpectralFitting.jl"/><meta property="twitter:title" content="Using models · SpectralFitting.jl"/><meta name="description" content="Documentation for SpectralFitting.jl."/><meta property="og:description" content="Documentation for SpectralFitting.jl."/><meta property="twitter:description" content="Documentation for SpectralFitting.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="SpectralFitting.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">SpectralFitting.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../walkthrough/">Walkthrough</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/examples/">Diverse examples</a></li><li><a class="tocitem" href="../../examples/sherpa-example/">A quick guide</a></li></ul></li><li><span class="tocitem">Models</span><ul><li class="is-active"><a class="tocitem" href>Using models</a><ul class="internal"><li><a class="tocitem" href="#Defining-new-models"><span>Defining new models</span></a></li><li><a class="tocitem" href="#Model-abstraction"><span>Model abstraction</span></a></li><li><a class="tocitem" href="#Model-methods"><span>Model methods</span></a></li><li><a class="tocitem" href="#Model-algebra"><span>Model algebra</span></a></li><li><a class="tocitem" href="#Model-data-availability"><span>Model data availability</span></a></li></ul></li><li><a class="tocitem" href="../models/">Model index</a></li><li><a class="tocitem" href="../composite-models/">Composite models</a></li><li><a class="tocitem" href="../surrogate-models/">Surrogate models</a></li><li><a class="tocitem" href="../xspec-models/">XSPEC models</a></li></ul></li><li><span class="tocitem">Fitting</span><ul><li><a class="tocitem" href="../../parameters/">Parameters</a></li></ul></li><li><span class="tocitem">Datasets</span><ul><li><a class="tocitem" href="../../datasets/datasets/">Using datasets</a></li><li><a class="tocitem" href="../../datasets/mission-support/">Mission support</a></li></ul></li><li><a class="tocitem" href="../../why-and-how/">Why &amp; How</a></li><li><a class="tocitem" href="../../reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Models</a></li><li class="is-active"><a href>Using models</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Using models</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/fjebaker/SpectralFitting.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/fjebaker/SpectralFitting.jl/blob/main/docs/src/models/using-models.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Using-spectral-models"><a class="docs-heading-anchor" href="#Using-spectral-models">Using spectral models</a><a id="Using-spectral-models-1"></a><a class="docs-heading-anchor-permalink" href="#Using-spectral-models" title="Permalink"></a></h1><p>In this page you&#39;ll find how to use the spectral model library and how to define your own models. Using the model library is as easy as invoking or composing models from the <a href="@ref">Model Index</a>. For example:</p><pre><code class="language-julia hljs">model = PowerLaw()</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌ PowerLaw
│      K -&gt;  1 ± 0.1  ∈ [ 0, Inf ]<span class="sgr32">   FREE</span>
│      a -&gt;  2 ± 0.2  ∈ [ 0, Inf ]<span class="sgr32">   FREE</span>
└ </code></pre><p>In the output of the REPL we see the model name, and it&#39;s two parameters, with information about those parameters, such as the current value, the associated error (10% by defaul), the minimum and maximum values, and whether the parameter is frozen or not.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>See <a href="@ref"><code>FitParam</code></a> for full details about fitable parameters.</p></div></div><p>The parameters can be tweaked by accessing the fields</p><pre><code class="language-julia hljs">model.K.value = 2.0
model.K.frozen = true
model</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌ PowerLaw
│      K -&gt;  2  <span class="sgr36">                     FROZEN</span>
│      a -&gt;  2 ± 0.2  ∈ [ 0, Inf ]<span class="sgr32">   FREE</span>
└ </code></pre><p>We can invoke the model on a domain in the following way</p><pre><code class="language-julia hljs">domain = collect(range(0.1, 10.0, 100))
invokemodel(domain, model)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">99-element Vector{Float64}:
 10.0
  3.333333333333333
  1.666666666666667
  1.0
  0.6666666666666665
  0.4761904761904763
  0.3571428571428572
  0.2777777777777777
  0.22222222222222232
  0.18181818181818188
  ⋮
  0.002388915432393668
  0.002337540906965918
  0.002287805994051678
  0.00223964165733484
  0.00219298245614033
  0.0021477663230240474
  0.002103934357248094
  0.0020614306328591847
  0.0020202020202020055</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>By default, models are implemented to accept a single input vector with all of the low and high bin edges, and return a flux array with the flux in each energy bin. As such, it is here the case that:</p><pre><code class="language-julia hljs">length(flux) == length(energy) - 1</code></pre><p>Models need not be defined as such, however. See <a href="../../datasets/datasets/#SpectralFitting.AbstractLayout"><code>AbstractLayout</code></a> for more.</p></div></div><p>Models can be composed together following the <a href="#Model-algebra">Model algebra</a>. That means to expressive a photoelectric absorption component acting on the power law we can write</p><pre><code class="language-julia hljs">model2 = PhotoelectricAbsorption() * model</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌ CompositeModel with 2 model components:
│      <span class="sgr36">m1 * a1</span>
│ Model key and parameters:
│ <span class="sgr36">   a1</span> =&gt; <span class="sgr36">PowerLaw</span>
│       K_1 -&gt;  2  <span class="sgr36">                     FROZEN</span>
│       a_1 -&gt;  2 ± 0.2  ∈ [ 0, Inf ]<span class="sgr32">   FREE</span>
│ <span class="sgr36">   m1</span> =&gt; <span class="sgr36">PhotoelectricAbsorption</span>
│      ηH_1 -&gt;  1 ± 0.1  ∈ [ 0, Inf ]<span class="sgr32">   FREE</span>
└ </code></pre><p>The parameters of this <a href="../composite-models/#SpectralFitting.CompositeModel"><code>CompositeModel</code></a> are are copied from the expression. This means we can modify the <code>K_1</code> parameter in <code>model2</code> without having to worry that we are changing <code>model.K</code>:</p><pre><code class="language-julia hljs">model2.K_1.frozen = false
model2</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌ CompositeModel with 2 model components:
│      <span class="sgr36">m1 * a1</span>
│ Model key and parameters:
│ <span class="sgr36">   a1</span> =&gt; <span class="sgr36">PowerLaw</span>
│       K_1 -&gt;  2 ± 0.1  ∈ [ 0, Inf ]<span class="sgr32">   FREE</span>
│       a_1 -&gt;  2 ± 0.2  ∈ [ 0, Inf ]<span class="sgr32">   FREE</span>
│ <span class="sgr36">   m1</span> =&gt; <span class="sgr36">PhotoelectricAbsorption</span>
│      ηH_1 -&gt;  1 ± 0.1  ∈ [ 0, Inf ]<span class="sgr32">   FREE</span>
└ </code></pre><pre><code class="language-julia hljs">model</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌ PowerLaw
│      K -&gt;  2  <span class="sgr36">                     FROZEN</span>
│      a -&gt;  2 ± 0.2  ∈ [ 0, Inf ]<span class="sgr32">   FREE</span>
└ </code></pre><p>Composite models have the same methods as single models. This means we can invoke a model in the same way</p><pre><code class="language-julia hljs">invokemodel(domain, model2)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">99-element view(::Matrix{Float64}, :, 1) with eltype Float64:
 2.0751585013952092e-263
 4.495947705380242e-37
 6.169182651763269e-13
 4.3452153392915345e-6
 0.00071255337382327
 0.0002950219828216392
 0.0025894772776999717
 0.005476504002915039
 0.008240937581191064
 0.014887524257980244
 ⋮
 0.002352926658712353
 0.0023033682709992184
 0.002255340978829189
 0.002208782849254055
 0.002163635423211736
 0.0021198431935328848
 0.0020773528501903667
 0.0020361145193630906
 0.001996079508045848</code></pre><h2 id="Defining-new-models"><a class="docs-heading-anchor" href="#Defining-new-models">Defining new models</a><a id="Defining-new-models-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-new-models" title="Permalink"></a></h2><p>To define your own model, you need to tell the package what the model parameters are and how to invoke the model. This is all done by creating a <code>struct</code> which subtypes <a href="#SpectralFitting.AbstractSpectralModel"><code>AbstractSpectralModel</code></a>.</p><p>Let&#39;s create a new <a href="#SpectralFitting.Additive"><code>Additive</code></a> spectral model:</p><pre><code class="language-julia hljs">Base.@kwdef struct MyModel{T} &lt;: AbstractSpectralModel{T,Additive}
    K::T = FitParam(2.0)
    p::T = FitParam(3.0)
end

# implementing a dummy add operation this function can do anything it likes, but
# must write the output into `output` and ideally should be thread safe
function SpectralFitting.invoke!(output, input, model::MyModel)
    SpectralFitting.finite_diff_kernel!(output, input) do E
        E + model.p
    end
end</code></pre><p>Here we used the utility method <a href="../models/#SpectralFitting.finite_diff_kernel!"><code>SpectralFitting.finite_diff_kernel!</code></a> to ensure the additive model is appropriately scaled across the bin width.</p><p>Note that <a href="#SpectralFitting.Additive"><code>Additive</code></a> models do not need to use the normalization parameter <code>K</code> themselves. This is because when we use <a href="#SpectralFitting.invokemodel"><code>invokemodel</code></a> these sorts of translations are automatically applied, for compatability with external models.</p><p>Our model is now ready to use</p><pre><code class="language-julia hljs">model = MyModel()</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌ MyModel
│      K -&gt;  2 ± 0.2  ∈ [ 0, Inf ]<span class="sgr32">   FREE</span>
│      p -&gt;  3 ± 0.3  ∈ [ 0, Inf ]<span class="sgr32">   FREE</span>
└ </code></pre><pre><code class="language-julia hljs">domain = collect(range(0.1, 10.0, 100))
invokemodel(domain, model)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">99-element Vector{Float64}:
 0.20000000000000018
 0.1999999999999993
 0.20000000000000018
 0.20000000000000018
 0.20000000000000018
 0.20000000000000018
 0.1999999999999993
 0.20000000000000018
 0.20000000000000018
 0.1999999999999993
 ⋮
 0.1999999999999993
 0.20000000000000284
 0.1999999999999993
 0.1999999999999993
 0.1999999999999993
 0.1999999999999993
 0.20000000000000284
 0.1999999999999993
 0.1999999999999993</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>To add new XSPEC or foreign function models, see <a href="@ref">Wrapping new XSPEC models</a>.</p></div></div><h2 id="Model-abstraction"><a class="docs-heading-anchor" href="#Model-abstraction">Model abstraction</a><a id="Model-abstraction-1"></a><a class="docs-heading-anchor-permalink" href="#Model-abstraction" title="Permalink"></a></h2><p>All spectral models are a sub-type of <a href="#SpectralFitting.AbstractSpectralModel"><code>AbstractSpectralModel</code></a>.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SpectralFitting.AbstractSpectralModel" href="#SpectralFitting.AbstractSpectralModel"><code>SpectralFitting.AbstractSpectralModel</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">abstract type AbstractSpectralModel{T,K&lt;:AbstractSpectralModelKind} end</code></pre><p>Supertype of all spectral models, tracking the number type <code>T</code> and <a href="@def"><code>AbstractSpectralModelKind</code></a> denoted <code>K</code>.</p><p><strong>Implementation</strong></p><p>Sub-types must implement the following interface (see the function&#39;s documentation for examples):</p><ul><li><a href="#SpectralFitting.invoke!"><code>SpectralFitting.invoke!</code></a></li></ul><p><strong>Usage</strong></p><p>The available API for a spectral model is detailed below:</p><ul><li><a href="#SpectralFitting.invokemodel"><code>invokemodel</code></a> / <a href="#SpectralFitting.invokemodel!"><code>invokemodel!</code></a>: the primary way to invoke a model.</li><li><a href="@ref"><code>allocate_model_output</code></a>: allocate the output matrix for the model.</li></ul><p>The following query functions exist:</p><ul><li><a href="#SpectralFitting.modelkind"><code>modelkind</code></a> for obtaining <code>K</code></li><li><a href="#SpectralFitting.numbertype"><code>numbertype</code></a> for obtaining <code>T</code></li><li><a href="#SpectralFitting.implementation"><code>implementation</code></a> used to assertain whether we can do things like automatic differentation through this model.</li></ul><p>Model reflection is supported by the following functions. These are intended for internal use and are not exported.</p><ul><li><a href="@ref"><code>parameter_named_tuple</code></a></li><li><a href="@ref"><code>parameter_tuple</code></a></li><li><a href="@ref"><code>remake_model_with_parameters</code></a></li><li><a href="@ref"><code>destructure_model</code></a></li></ul><p>The parametric type parameter <code>T</code> is the number type of the model and <code>K</code> defines the <a href="#SpectralFitting.AbstractSpectralModelKind"><code>AbstractSpectralModelKind</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fjebaker/SpectralFitting.jl/blob/1abdc8092cf26691256251c18aeeb87f31546974/src/abstract-models.jl#L63-L97">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SpectralFitting.invoke!" href="#SpectralFitting.invoke!"><code>SpectralFitting.invoke!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">SpectralFitting.invoke!(output, domain, M::Type{&lt;:AbstractSpectralModel}, params...)</code></pre><p>Used to define the behaviour of models. Should calculate the output of the model and write in-place into <code>output</code>. The model parameters are passed in the model structure.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>This function should not be called directly. Use <a href="#SpectralFitting.invokemodel"><code>invokemodel</code></a> instead. <code>invoke!</code> is only to define the model, not to use it. Users should always call models using <a href="#SpectralFitting.invokemodel"><code>invokemodel</code></a> or <a href="#SpectralFitting.invokemodel!"><code>invokemodel!</code></a> to ensure normalisations and closures are accounted for.</p></div></div><p><strong>Example</strong></p><pre><code class="language-julia hljs">Base.@kwdef struct MyModel{T} &lt;: AbstractSpectralModel{T,Multiplicative}
    p1::T = FitParam(1.0)
    p2::T = FitParam(2.0)
    p3::T = FitParam(3.0)
end</code></pre><p>would have the arguments passed to <code>invoke!</code> as</p><pre><code class="language-julia hljs">function SpectralFitting.invoke!(output, domain, model::MyModel)
    # ...
end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fjebaker/SpectralFitting.jl/blob/1abdc8092cf26691256251c18aeeb87f31546974/src/abstract-models.jl#L185-L212">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SpectralFitting.modelkind" href="#SpectralFitting.modelkind"><code>SpectralFitting.modelkind</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">modelkind(M::Type{&lt;:AbstractSpectralModel})
modelkind(::AbstractSpectralModel)</code></pre><p>Return the kind of model given by <code>M</code>: either <code>Additive</code>, <code>Multiplicative</code>, or <code>Convolutional</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fjebaker/SpectralFitting.jl/blob/1abdc8092cf26691256251c18aeeb87f31546974/src/abstract-models.jl#L133-L138">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SpectralFitting.numbertype" href="#SpectralFitting.numbertype"><code>SpectralFitting.numbertype</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">numbertype(::AbstractSpectralModel)</code></pre><p>Get the numerical type of the model. This goes through <a href="@ref"><code>FitParam</code></a>, so that the number type returned is as close to a primative as possible.</p><p>See also <a href="@ref"><code>paramtype</code></a>.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">numbertype(PowerLaw()) == Float64</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fjebaker/SpectralFitting.jl/blob/1abdc8092cf26691256251c18aeeb87f31546974/src/abstract-models.jl#L101-L114">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SpectralFitting.implementation" href="#SpectralFitting.implementation"><code>SpectralFitting.implementation</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">implementation(model::AbstractSpectralModel)
implementation(::Type{&lt;:AbstractSpectralModel})</code></pre><p>Get the <a href="@ref"><code>AbstractSpectralModelImplementation</code></a> for a given <a href="#SpectralFitting.AbstractSpectralModel"><code>AbstractSpectralModel</code></a> or model type.</p><p>This is used primarily to learn what optimizations we can do with a model, for example propagating auto-diff gradients through a model or arbitrary precision numbers.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fjebaker/SpectralFitting.jl/blob/1abdc8092cf26691256251c18aeeb87f31546974/src/abstract-models.jl#L157-L167">source</a></section></article><h2 id="Model-methods"><a class="docs-heading-anchor" href="#Model-methods">Model methods</a><a id="Model-methods-1"></a><a class="docs-heading-anchor-permalink" href="#Model-methods" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SpectralFitting.invokemodel" href="#SpectralFitting.invokemodel"><code>SpectralFitting.invokemodel</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">invokemodel(domain, model::AbstractSpectralModel)</code></pre><p>Invoke the <a href="#SpectralFitting.AbstractSpectralModel"><code>AbstractSpectralModel</code></a> given by <code>model</code> over the domain <code>domain</code>.</p><p>This function will perform any normalisation or post-processing tasks that a specific model kind may require, e.g. multiplying by a normalisation constant for <a href="#SpectralFitting.Additive"><code>Additive</code></a> models.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"></div></div><p><code>invokemodel</code> allocates the needed output arrays based on the element type of <code>free_params</code> to allow automatic differentation libraries to calculate parameter gradients.</p><p>In-place non-allocating variants are the <a href="#SpectralFitting.invokemodel!"><code>invokemodel!</code></a> functions.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">model = PowerLaw()
domain = collect(range(0.1, 20.0, 100))

invokemodel(domain, model)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fjebaker/SpectralFitting.jl/blob/1abdc8092cf26691256251c18aeeb87f31546974/src/abstract-models.jl#L215-L238">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SpectralFitting.invokemodel!" href="#SpectralFitting.invokemodel!"><code>SpectralFitting.invokemodel!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">invokemodel!(output, domain, model)
invokemodel!(output, domain, model, params::AbstractVector)
invokemodel!(output, domain, model, params::ParameterCache)</code></pre><p>In-place variant of <a href="#SpectralFitting.invokemodel"><code>invokemodel</code></a>, calculating the output of an <a href="#SpectralFitting.AbstractSpectralModel"><code>AbstractSpectralModel</code></a> given by <code>model</code>, optionally overriding the parameters using a <a href="@ref"><code>ParameterCache</code></a> or an <code>AbstractVector</code>.</p><p>The <code>output</code> may not necessarily be a single vector, and one should use <a href="@ref"><code>allocate_model_output</code></a> to allocate the output structure.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">model = PowerLaw()
domain = collect(range(0.1, 20.0, 100))
output = allocate_model_output(model, domain)
invokemodel!(output, domain, model)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fjebaker/SpectralFitting.jl/blob/1abdc8092cf26691256251c18aeeb87f31546974/src/abstract-models.jl#L245-L265">source</a></section></article><h2 id="Model-algebra"><a class="docs-heading-anchor" href="#Model-algebra">Model algebra</a><a id="Model-algebra-1"></a><a class="docs-heading-anchor-permalink" href="#Model-algebra" title="Permalink"></a></h2><p>Models exist as three different kinds, defined by an <a href="#SpectralFitting.AbstractSpectralModelKind"><code>AbstractSpectralModelKind</code></a> trait.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SpectralFitting.AbstractSpectralModelKind" href="#SpectralFitting.AbstractSpectralModelKind"><code>SpectralFitting.AbstractSpectralModelKind</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">abstract type AbstractSpectralModelKind</code></pre><p>Abstract type of all model kinds. The algebra of models is as follows</p><pre><code class="language-julia hljs">A + A = A
M * M = M
M * A = A
C(A)  = A</code></pre><p>where <code>A</code> is <a href="#SpectralFitting.Additive"><code>Additive</code></a>, <code>M</code> is <a href="../models/#Multiplicative"><code>Multiplicative</code></a>, and <code>C</code> is <a href="../models/#Convolutional"><code>Convolutional</code></a>. All other operations are prohibited, e.g. <code>C(M)</code> or <code>M * C</code>. To obtain <code>M * C</code> there must be an additive component, e.g. <code>M * C(A)</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fjebaker/SpectralFitting.jl/blob/1abdc8092cf26691256251c18aeeb87f31546974/src/abstract-models.jl#L19-L32">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SpectralFitting.Additive" href="#SpectralFitting.Additive"><code>SpectralFitting.Additive</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Additive &lt;: AbstractSpectralModelKind
Additive()</code></pre><p>Additive models are effectively the sources of photons, and are the principle building blocks of composite models. Every additive model has a normalisation parameter which re-scales the output by a constant factor <code>K</code>.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Defining custom additive models requires special care. See <a href="#Defining-new-models">Defining new models</a>.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fjebaker/SpectralFitting.jl/blob/1abdc8092cf26691256251c18aeeb87f31546974/src/abstract-models.jl#L34-L44">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SpectralFitting.Multiplicative" href="#SpectralFitting.Multiplicative"><code>SpectralFitting.Multiplicative</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Multiplicative &lt;: AbstractSpectralModelKind
Multiplicative()</code></pre><p>Multiplicative models act on <a href="#SpectralFitting.Additive"><code>Additive</code></a> models, by element-wise multiplying the output in each domain bin of the additive model by a different factor.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fjebaker/SpectralFitting.jl/blob/1abdc8092cf26691256251c18aeeb87f31546974/src/abstract-models.jl#L46-L52">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SpectralFitting.Convolutional" href="#SpectralFitting.Convolutional"><code>SpectralFitting.Convolutional</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Convolutional &lt;: AbstractSpectralModelKind
Convolutional()</code></pre><p>Convolutional models act on the output generated by <a href="#SpectralFitting.Additive"><code>Additive</code></a> models, similar to <a href="../models/#Multiplicative"><code>Multiplicative</code></a> models, however may convolve kernels through the output also.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fjebaker/SpectralFitting.jl/blob/1abdc8092cf26691256251c18aeeb87f31546974/src/abstract-models.jl#L54-L60">source</a></section></article><h2 id="Model-data-availability"><a class="docs-heading-anchor" href="#Model-data-availability">Model data availability</a><a id="Model-data-availability-1"></a><a class="docs-heading-anchor-permalink" href="#Model-data-availability" title="Permalink"></a></h2><p>Many of the XSPEC implemented models use tabular data, such as FITS, and return results interpolated from these pre-calculated tables. In some cases, these table models have data files that are multiple gigabytes in size, and would be very unwieldy to ship indiscriminantly. SpectralFitting attempts to circumnavigate this bloat by downloading the model data on an <em>ut opus</em> basis.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SpectralFitting.download_model_data" href="#SpectralFitting.download_model_data"><code>SpectralFitting.download_model_data</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">SpectralFitting.download_model_data(model::AbstractSpectralModel; kwargs...)
SpectralFitting.download_model_data(M::Type{&lt;:AbstractSpectralModel}; kwargs...)
SpectralFitting.download_model_data(s::Symbol; kwargs...)</code></pre><p>Downloads the model data for a model specified either by <code>model</code>, type <code>M</code>, or symbol <code>s</code>. Datafiles associated with a specific model may be registered using <a href="../models/#SpectralFitting.register_model_data"><code>SpectralFitting.register_model_data</code></a>. The download is currently unconfigurable, but permits slight control via a number of keyword arguments:</p><ul><li><code>progress::Bool = true</code></li></ul><p>Display a progress bar for the download.</p><ul><li><code>model_source_url::String = &quot;http://www.star.bris.ac.uk/fbaker/XSPEC-model-data&quot;</code></li></ul><p>The source URL used to download the model data.</p><p>All standard XSPEC spectral model data is currently being hosted on the University of Bristol astrophysics servers, and should be persistently available to anyone.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fjebaker/SpectralFitting.jl/blob/1abdc8092cf26691256251c18aeeb87f31546974/src/model-data-io.jl#L171-L190">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SpectralFitting.download_all_model_data" href="#SpectralFitting.download_all_model_data"><code>SpectralFitting.download_all_model_data</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">SpectralFitting.download_all_model_data()</code></pre><p>Downloads all model data for the models currently registered with <a href="../models/#SpectralFitting.register_model_data"><code>SpectralFitting.register_model_data</code></a>. Calls <a href="#SpectralFitting.download_model_data"><code>SpectralFitting.download_model_data</code></a> to perform the download.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fjebaker/SpectralFitting.jl/blob/1abdc8092cf26691256251c18aeeb87f31546974/src/model-data-io.jl#L57-L62">source</a></section></article><p>Special care must be taken if new XSPEC models are wrapped to ensure the data is available. For more on this, see <a href="@ref">Wrapping new XSPEC models</a>.</p><p>Model data may also alternatively be copied in <em>by-hand</em> from a HEASoft XSPEC source directory. In this case, the location to copy the data to may be determined via <code>joinpath(SpectralFitting.LibXSPEC_jll.artifact_dir, &quot;spectral&quot;, &quot;modelData&quot;)</code>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../examples/sherpa-example/">« A quick guide</a><a class="docs-footer-nextpage" href="../models/">Model index »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Wednesday 8 January 2025 14:48">Wednesday 8 January 2025</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
